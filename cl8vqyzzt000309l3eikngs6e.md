## Command Design Pattern And Its Implementation In Python

The Command design pattern is a behavioral pattern that converts a request into a stand-alone object that contains all the information needed for performing the request. Using this approach has the following benefits:
- The request can be passed as an argument to other functions and methods.
- The request can be queued and executed later.
- Provides support for Redo and Undo logic, if applicable.

- Provides support for issuing command on one device and running it on another device also known as networking. (for example in online games)


To better demonstrate this concept, consider that you are building a text editor. Your app has a user interface for communicating with users. This GUI has some buttons for executing commands like copy, paste, save,... How can we implement this using object-oriented design? Perhaps what comes to mind is that you create a Button base class and a bunch of sub-classes like CancelButton, SaveButton, CopyButton, and so on and then implement the actual logic inside each of them. But what is wrong with this approach? Soon you recognize that you have so many sub-classes, but that is not all. The main problem arises when you add other UI components to perform the same work, for example, adding an Edit menu on top of the page or adding keyboard shortcuts. In this case, should we implement the logic in each of these objects? Of course, the answer is no, because doing this makes our code error prone due to duplication, and changing the logic becomes a headache since you have to change so many different places. 
### Command Design Pattern
The solution is to create a command interface. This interface has only one method **execute()**. All business logic commands can be implementations of this interface, and all GUI elements just call the execute method on the relevant command.
### Code example
Let's take advantage of a classic example to demonstrate the command design pattern. Consider that you are designing and building a software system for a bank, and its basic services are depositing, withdrawing, and transferring money from one account to another. This system would be accessed through a mobile app, an ATM device, and a web app.
Lets start with implementing business model.
```Python
from dataclasses import dataclass, field
import random
import string


def create_acc_id():
    return "".join(random.choices(string.digits, k=12))


@dataclass
class Account:
    owner: str
    acc_id: str = field(default_factory=create_acc_id)
    balance: int = 0

    @staticmethod
    def is_valid_deposite_amount(amount: float) -> bool:
        return isinstance(amount, float) and amount >= 0

    def is_valid_withdraw_amount(self, amount: float) -> bool:
        return isinstance(amount, float) and amount < self.balance

    def deposit(self, amount: float) -> None:
        if not self.is_valid_deposite_amount(amount):
            raise ValueError("You can only deposit none negative amount")
        self.balance += amount

    def withdraw(self, amount: float) -> None:
        if not self.is_valid_withdraw_amount(amount):
            raise ValueError(f"You can not withdraw ${amount}")
        self.balance -= amount

class Bank:
    def __init__(self) -> None:
        self.__accounts = {}
        self.__archived = {}

    def open_account(self, account: Account) -> None:
        if account.acc_id in self.__accounts:
            raise ValueError("This account already exists")
        self.__accounts.update({account.acc_id: account})

    def close_account(self, account: Account) -> None:
        if not account.acc_id in self.__accounts:
            raise ValueError("No such account")
        del self.__accounts[account.acc_id]
        self.__archived.update({account.acc_id: account})
```
 

![CommandDesignPattern.drawio.png](https://cdn.hashnode.com/res/hashnode/image/upload/v1664980758694/Bvs9j9Bpx.png align="center")
### Resources to learn more:

- https://refactoring.guru/design-patterns/command

- [Implementing Undo And Redo With The Command Design Pattern](https://youtu.be/FM71_a3txTo)

- [Command pattern. (2022, May 27). In Wikipedia.](https://en.wikipedia.org/wiki/Command_pattern)






